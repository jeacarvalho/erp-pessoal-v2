"""Teste unitário para validação da importação de notas fiscais via XML."""

from backend.app.services.xml_handler import XMLProcessor


# Nota que importou corretamente
NOTA_OK = '''<?xml version="1.0" encoding="UTF-8" standalone="no"?><nfeProc versao="4.00" xmlns="http://www.portalfiscal.inf.br/nfe"><NFe><infNFe Id="NFe35260203007331021220550020099992201486087786" versao="4.00"><ide><cUF>35</cUF><cNF>48608778</cNF><natOp>Venda de mercadorias</natOp><mod>55</mod><serie>2</serie><nNF>9999220</nNF><dhEmi>2026-02-13T16:09:53-03:00</dhEmi><dhSaiEnt>2026-02-13T16:09:53-03:00</dhSaiEnt><tpNF>1</tpNF><idDest>2</idDest><cMunFG>3509205</cMunFG><tpImp>1</tpImp><tpEmis>1</tpEmis><cDV>6</cDV><tpAmb>1</tpAmb><finNFe>1</finNFe><indFinal>1</indFinal><indPres>2</indPres><indIntermed>1</indIntermed><procEmi>0</procEmi><verProc>mercadolivre.invoice</verProc><NFref><refNFe>35260203007331021220550020099992041806187081</refNFe></NFref></ide><emit><CNPJ>03007331021220</CNPJ><xNome>EBAZAR.COM.BR. LTDA</xNome><enderEmit><xLgr>Avenida Doutor Antonio Joao Abdalla</xLgr><nro>3.333</nro><xCpl>Setor Parte B 0001 Lote Sitio Paes Parte 01</xCpl><xBairro>Nao informado</xBairro><cMun>3509205</cMun><xMun>Cajamar</xMun><UF>SP</UF><CEP>07750020</CEP><cPais>1058</cPais><xPais>Brasil</xPais><fone>00000000</fone></enderEmit><IE>241223511112</IE><IEST>15818530</IEST><CRT>3</CRT></emit><dest><CPF>01553360702</CPF><xNome>Jose Eduardo Alves de Carvalho</xNome><enderDest><xLgr>Rua Jornalista Paulo Francis</xLgr><nro>33</nro><xCpl>Camboinhas - Rua De Paralelepipedo</xCpl><xBairro>Camboinhas</xBairro><cMun>3303302</cMun><xMun>Niteroi</xMun><UF>RJ</UF><CEP>24358685</CEP><cPais>1058</cPais><xPais>Brasil</xPais></enderDest><indIEDest>9</indIEDest></dest><det nItem="1"><prod><cProd>1481870</cProd><cEAN>7898951850064</cEAN><xProd>Macarrao com Ovos Espaguete 8 Barilla Pacote 500g</xProd><NCM>19021100</NCM><CEST>1704907</CEST><CFOP>6106</CFOP><uCom>UN</uCom><qCom>2</qCom><vUnCom>4.19000000</vUnCom><vProd>8.38</vProd><cEANTrib>7898951850064</cEANTrib><uTrib>UN</uTrib><qTrib>2</qTrib><vUnTrib>4.19000000</vUnTrib><indTot>1</indTot><xPed>200001512380267</xPed></prod><imposto><vTotTrib>2.24</vTotTrib><ICMS><ICMS00><orig>0</orig><CST>00</CST><modBC>3</modBC><vBC>8.38</vBC><pICMS>12.0000</pICMS><vICMS>1.01</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPINT><CST>53</CST></IPINT></IPI><PIS><PISNT><CST>06</CST></PISNT></PIS><COFINS><COFINSNT><CST>06</CST></COFINSNT></COFINS><ICMSUFDest><vBCUFDest>2.93</vBCUFDest><vBCFCPUFDest>0.00</vBCFCPUFDest><pFCPUFDest>0.0000</pFCPUFDest><pICMSUFDest>20.0000</pICMSUFDest><pICMSInter>12.00</pICMSInter><pICMSInterPart>100.0000</pICMSInterPart><vFCPUFDest>0.00</vFCPUFDest><vICMSUFDest>0.00</vICMSUFDest><vICMSUFRemet>0.00</vICMSUFRemet></ICMSUFDest></imposto><infAdProd>xPed:2000015123802670 Total aproximado de tributos federais, estaduais e municipais: R$2,24</infAdProd></det><total><ICMSTot><vBC>8.38</vBC><vICMS>1.01</vICMS><vICMSDeson>0.00</vICMSDeson><vFCPUFDest>0.00</vFCPUFDest><vICMSUFDest>0.00</vICMSUFDest><vICMSUFRemet>0.00</vICMSUFRemet><vFCP>0.00</vFCP><vBCST>0.00</vBCST><vST>0.00</vST><vFCPST>0.00</vFCPST><vFCPSTRet>0.00</vFCPSTRet><vProd>8.38</vProd><vFrete>0.00</vFrete><vSeg>0.00</vSeg><vDesc>0.00</vDesc><vII>0.00</vII><vIPI>0.00</vIPI><vIPIDevol>0.00</vIPIDevol><vPIS>0.00</vPIS><vCOFINS>0.00</vCOFINS><vOutro>0.00</vOutro><vNF>8.38</vNF><vTotTrib>2.24</vTotTrib></ICMSTot></total><transp><modFrete>2</modFrete><vol><qVol>1</qVol><pesoL>0.500</pesoL><pesoB>0.500</pesoB></vol></transp><pag><detPag><indPag>0</indPag><tPag>03</tPag><vPag>8.38</vPag><card><tpIntegra>1</tpIntegra><CNPJ>03007331000141</CNPJ><tBand>02</tBand><cAut>767015</cAut></card></detPag></pag><infIntermed><CNPJ>03007331000141</CNPJ><idCadIntTran>480265022</idCadIntTran></infIntermed><infAdic><infCpl>Enviado diretamente do deposito temporario - operador logistico: EBAZAR.COM.BR LTDA, Cnpj: 03007331001466, Inscricao Estadual: 734039990115 saindo do endereco: Rod. Pres. Castello Branco, KM 46 QUADRA01 LOTE EST.0 , Numero: 3355, Complemento: , Bairro: Estiva, Cidade: Aracariguama, Cep: 18149904, Estado: SP, Pais: BR. Nota fiscal de retorno simbolico n 9999204, emitida em 13/02/2026, serie 2, nos termos da Portaria CAT 31/2019 Valor aproximado dos tributos (IBPT) R$2,24. Valores totais do ICMS Interestadual: DIFAL da UF destino R$0,00 + FCP R$0,00; DIFAL da UF Origem R$0,00.</infCpl><obsCont xCampo="external_id"><xTexto>SALE-sale-46457794813-2-OLSS-480265022</xTexto></obsCont></infAdic></infNFe><Signature xmlns="http://www.w3.org/2000/09/xmldsig#"><SignedInfo><CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/><SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/><Reference URI="#NFe35260203007331021220550020099992201486087786"><Transforms><Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/><Transform Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/></Transforms><DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/><DigestValue>4jszW/ZORP7LhoO/VG8YFD7GuWE=</DigestValue></Reference></SignedInfo><SignatureValue>g5EQuTdWO6RpsCqqY/Kuaru/lkPIMcYmDmGO40gZJsl94SnW5G7J1MzxXaFE4bOc5sEkEUZpGa/ShN96fQqw+8sUGxHlTvXGJ4B5ny739+E04FSJG0wakjyGPFdCKGXrBic0T3s1biEpifjQ04WeyD1Z+5pXsX4VOqlRMOX+U313GzFpH4hfuKIUv5v7IIRrBJ5EovgVHMi/6vsVDOEmDtPX6l31ATAbSYYGZpJZNoJWO9O1pTezQXZq0ZIhYelD9vEa6qDGpfQESRC/JEADEJ/Pk+gfN5r/1OclyV/5yhCs/o/BjKTUWkA4CsbsNr9Sc7EM3g7H00ZLaGtfGEZZdQ==</SignatureValue><KeyInfo><X509Data><X509Certificate>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</X509Certificate></X509Data></KeyInfo></Signature></NFe><protNFe versao="4.00"><infProt><tpAmb>1</tpAmb><verAplic>SP_NFE_PL009_V4</verAplic><chNFe>35260203007331021220550020099992201486087786</chNFe><dhRecbto>2026-02-13T16:09:55-03:00</dhRecbto><nProt>135260589678403</nProt><digVal>4jszW/ZORP7LhoO/VG8YFD7GuWE=</digVal><cStat>100</cStat><xMotivo>Autorizado o uso da NF-e</xMotivo></infProt></protNFe></nfeProc>'''

# Nota que não importou corretamente
NOTA_ERRO = '''<?xml version="1.0" encoding="UTF-8" standalone="no"?><nfeProc versao="4.00" xmlns="http://www.portalfiscal.inf.br/nfe"><NFe><infNFe Id="NFe31260238001021000102550020006580571544044510" versao="4.00"><ide><cUF>31</cUF><cNF>54404451</cNF><natOp>Venda de mercadorias</natOp><mod>55</mod><serie>2</serie><nNF>658057</nNF><dhEmi>2026-02-04T17:08:31-03:00</dhEmi><dhSaiEnt>2026-02-04T17:08:31-03:00</dhSaiEnt><tpNF>1</tpNF><idDest>2</idDest><cMunFG>3102605</cMunFG><tpImp>1</tpImp><tpEmis>1</tpEmis><cDV>0</cDV><tpAmb>1</tpAmb><finNFe>1</finNFe><indFinal>1</indFinal><indPres>2</indPres><indIntermed>1</indIntermed><procEmi>0</procEmi><verProc>mercadolivre.invoice</verProc><NFref><refNFe>31260238001021000102550020006580561647692991</refNFe></NFref></ide><emit><CNPJ>38001021000102</CNPJ><xNome>PERES COMPANY MG LTDA</xNome><enderEmit><xLgr>Av Mario Lanzani</xLgr><nro>1453</nro><xCpl>Nao consta</xCpl><xBairro>Jardim Rio Branco</xBairro><cMun>3102605</cMun><xMun>Andradas</xMun><UF>MG</UF><CEP>37840300</CEP><cPais>1058</cPais><xPais>Brasil</xPais><fone>1930566817</fone></enderEmit><IE>0045358490000</IE><IEST>12754663</IEST><CRT>3</CRT></emit><dest><CPF>01553360702</CPF><xNome>Jose Eduardo Alves de Carvalho</xNome><enderDest><xLgr>Rua Jornalista Paulo Francis</xLgr><nro>33</nro><xCpl>Camboinhas - Rua De Paralelepipedo</xCpl><xBairro>Camboinhas</xBairro><cMun>3303302</cMun><xMun>Niteroi</xMun><UF>RJ</UF><CEP>24358685</CEP><cPais>1058</cPais><xPais>Brasil</xPais></enderDest><indIEDest>9</indIEDest></dest><det nItem="1"><prod><cProd>5977</cProd><cEAN>7899923606450</cEAN><xProd>Cerveja Artesanal Roleta Russa Easy Ipa Sem Alcool 350ml</xProd><NCM>22030000</NCM><CEST>0302103</CEST><CFOP>6106</CFOP><uCom>UN</uCom><qCom>12</qCom><vUnCom>5.21333333</vUnCom><vProd>62.56</vProd><cEANTrib>7899923606450</cEANTrib><uTrib>UN</uTrib><qTrib>12</qTrib><vUnTrib>5.21333333</vUnTrib><indTot>1</indTot><xPed>200001500624976</xPed></prod><imposto><vTotTrib>26.53</vTotTrib><ICMS><ICMS00><orig>0</orig><CST>00</CST><modBC>3</modBC><vBC>62.56</vBC><pICMS>12.0000</pICMS><vICMS>7.51</vICMS></ICMS00></ICMS><IPI><cEnq>999</cEnq><IPINT><CST>53</CST></IPINT></IPI><PIS><PISNT><CST>06</CST></PISNT></PIS><COFINS><COFINSNT><CST>06</CST></COFINSNT></COFINS><ICMSUFDest><vBCUFDest>62.56</vBCUFDest><vBCFCPUFDest>62.56</vBCFCPUFDest><pFCPUFDest>2.0000</pFCPUFDest><pICMSUFDest>20.0000</pICMSUFDest><pICMSInter>12.00</pICMSInter><pICMSInterPart>100.0000</pICMSInterPart><vFCPUFDest>1.25</vFCPUFDest><vICMSUFDest>5.00</vICMSUFDest><vICMSUFRemet>0.00</vICMSUFRemet></ICMSUFDest></imposto><infAdProd>xPed:2000015006249768 Total aproximado de tributos federais, estaduais e municipais: R$26,53</infAdProd></det><total><ICMSTot><vBC>62.56</vBC><vICMS>7.51</vICMS><vICMSDeson>0.00</vICMSDeson><vFCPUFDest>1.25</vFCPUFDest><vICMSUFDest>5.00</vICMSUFDest><vICMSUFRemet>0.00</vICMSUFRemet><vFCP>0.00</vFCP><vBCST>0.00</vBCST><vST>0.00</vST><vFCPST>0.00</vFCPST><vFCPSTRet>0.00</vFCPSTRet><vProd>62.56</vProd><vFrete>0.00</vFrete><vSeg>0.00</vSeg><vDesc>0.00</vDesc><vII>0.00</vII><vIPI>0.00</vIPI><vIPIDevol>0.00</vIPIDevol><vPIS>0.00</vPIS><vCOFINS>0.00</vCOFINS><vOutro>0.00</vOutro><vNF>62.56</vNF><vTotTrib>26.53</vTotTrib></ICMSTot></total><transp><modFrete>1</modFrete><transporta><CNPJ>03007331012239</CNPJ><xNome>EBAZAR.COM.BR LTDA</xNome><IE>120519234116</IE><xEnder>AVENIDA DAS NACOES UNIDAS 3000 3003</xEnder><xMun>OSASCO</xMun><UF>SP</UF></transporta><vol><qVol>1</qVol><pesoL>4.800</pesoL><pesoB>4.800</pesoB></vol></transp><pag><detPag><indPag>0</indPag><tPag>03</tPag><vPag>62.56</vPag><card><tpIntegra>1</tpIntegra><CNPJ>03007331000141</CNPJ><tBand>02</tBand><cAut>405293</cAut></card></detPag></pag><infIntermed><CNPJ>03007331000141</CNPJ><idCadIntTran>643859567</idCadIntTran></infIntermed><infAdic><infCpl>Enviado diretamente do deposito temporario - operador logistico: EBAZAR.COM.BR LTDA, Cnpj: 03007331013715 saindo do endereco: Avenida Joaquim Lourenco de Lima, Galpao 2, Numero: 450, Complemento: , Bairro: Distrito Industrial Vargem do Joao Pinto, Cidade: Extrema, Cep: 37644902, Estado: MG, Pais: BR. Inscricao Estadual do Operador Logistico: 0038450761964 Nota fiscal de retorno simbolico n 658056, emitida em 04/02/2026, serie 2 Valor aproximado dos tributos (IBPT) R$26,53. Valores totais do ICMS Interestadual: DIFAL da UF destino R$5,00 + FCP R$1,25; DIFAL da UF Origem R$0,00.</infCpl><obsCont xCampo="external_id"><xTexto>SALE-sale-46403812243-1-OLSS-643859567</xTexto></obsCont></infAdic></infNFe><Signature xmlns="http://www.w3.org/2000/09/xmldsig#"><SignedInfo><CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/><SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/><Reference URI="#NFe31260238001021000102550020006580571544044510"><Transforms><Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/><Transform Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/></Transforms><DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/><DigestValue>IEU8GFoVPx9fjdeAEQ4URRrhSBY=</DigestValue></Reference></SignedInfo><SignatureValue>aS6U4XopkWFKTS5tsq9vSzU2LYrjWQQGFUgrZL02dqaK7NY3jOPB4AuILuLy7h3VcRc7PFGj1fTknRwetyMLIUUFrBstYyDN0P/pdIkF9jjrh026ZU04aiORnrs5w/T2rqg1p+wwuSsxNpeDnmpA3HPFCliPupRVqZxO5B8jJqDkfTECr4qS9UQ9c6vAYrJkPhMF8TLaELHBOw8WwlRYcFpDBG4xUwjoQMVRYVzVfU80kI2Tj62NnLZIis6w+UBAyP2/WOIZwWupisKqfC9cuF/mpc+gTSQP4QEPIMCKiv3eyLZ/BL9Ene0FW6vDnXTl/9jUOYmqQi23CWzrjLxN3A==</SignatureValue><KeyInfo><X509Data><X509Certificate>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</X509Certificate></X509Data></KeyInfo></Signature></NFe><protNFe versao="4.00"><infProt><tpAmb>1</tpAmb><verAplic>W-3.3.39</verAplic><chNFe>31260238001021000102550020006580571544044510</chNFe><dhRecbto>2026-02-04T17:08:33-03:00</dhRecbto><nProt>131267281861379</nProt><digVal>IEU8GFoVPx9fjdeAEQ4URRrhSBY=</digVal><cStat>100</cStat><xMotivo>Autorizado o uso da NF-e</xMotivo></infProt></protNFe></nfeProc>'''


def test_xml_handler():
    """Teste para validar a importação de notas fiscais via XML."""
    processor = XMLProcessor()

    # Teste com a nota que anteriormente importava corretamente
    parsed_note_ok = processor.parse(NOTA_OK)
    
    # Verificar que o CEAN foi importado corretamente
    assert len(parsed_note_ok.items) == 1
    assert parsed_note_ok.items[0].ean == "7898951850064"
    assert parsed_note_ok.items[0].name == "Macarrao com Ovos Espaguete 8 Barilla Pacote 500g"

    # Teste com a nota que anteriormente não importava corretamente
    parsed_note_error = processor.parse(NOTA_ERRO)
    
    # Verificar que o CEAN agora é importado corretamente também
    assert len(parsed_note_error.items) == 1
    assert parsed_note_error.items[0].ean == "7899923606450"
    assert parsed_note_error.items[0].name == "Cerveja Artesanal Roleta Russa Easy Ipa Sem Alcool 350ml"

    print("✅ Todos os testes passaram com sucesso!")
    print(f"Nota OK - Item 0: EAN={parsed_note_ok.items[0].ean}, Nome='{parsed_note_ok.items[0].name}'")
    print(f"Nota ERRO - Item 0: EAN={parsed_note_error.items[0].ean}, Nome='{parsed_note_error.items[0].name}'")


if __name__ == "__main__":
    test_xml_handler()